<template lang="html">
  <div>
    <h1>Test Data</h1>
    <table>
      <tr>
        <th>#</th>
        <th>{{$t("message.TestIn")}}</th>
        <th>{{$t("message.TestOut")}}</th>
        <th>{{$t("message.Delete")}}</th>
      </tr>
      <tr v-for="item in list.testcases">
        <td>{{ item.uuid.slice(0, 8) }}</td>
        <td><a :href="testcaseUrl(item, 'in')" target="_blank" @click="search(item)">test.in</a></td>
        <td><a :href="testcaseUrl(item, 'out')" target="_blank">test.out</a></td>
        <td>
          <Button type="text" @click="del(item)">{{$t("message.Delete")}}</Button>
        </td>
      </tr>
    </table>
    <h1>{{$t("message.CreateNew")}}</h1>
    <p>In</p>
    <Input v-model="test.in" type="textarea" :autosize="{minRows: 5,maxRows: 25}"></Input>
    <p>Out</p>
    <Input v-model="test.out" type="textarea" :autosize="{minRows: 5,maxRows: 25}"></Input>
    <br>
    <br>
    <Button type="primary" @click="create"> {{$t("message.Submit")}} </Button>
  </div>
</template>

<script>
import { mapGetters } from 'vuex'
import { testcaseUrl } from '@/util/helper'

export default {
  i18n: {
    messages: {
      zh_CN: {
        message: {
          TestIn: '测试输入',
          TestOut: '测试输出',
          Delete: '删除',
          CreateNew: '新建',
          Submit: '提交'
        }
      },
      en_US: {
        message: {
          TestIn: 'Test In',
          TestOut: 'Test Out',
          Delete: 'Delete',
          CreateNew: 'Create New',
          Submit: 'Submit'
        }
      }
    }
  },
  data: () => ({
    test: {
      pid: '',
      in: '',
      out: ''
    }
  }),
  computed: {
    ...mapGetters('testcase', ['list', 'testcase'])
  },
  created () {
    this.fetch()
    this.test.pid = this.$route.params.pid
  },
  methods: {
    fetch () {
      this.$store.dispatch('testcase/find', this.$route.params)
    },
    search (item) {
      const testcase = {
        pid: this.$route.params.pid,
        uuid: item.uuid,
        type: 'in'
      }
      this.$store.dispatch('testcase/findOne', testcase)
    },
    del (item) {
      this.$Modal.confirm({
        title: '提示',
        content: '<p>此操作将永久删除该文件, 是否继续?</p>',
        onOk: () => {
          const testcase = {
            pid: this.$route.params.pid,
            uuid: item.uuid
          }
          this.$store.dispatch('testcase/delete', testcase).then(() => {
            this.$Message.success(`成功删除${item.uuid}！`)
          })
        },
        onCancel: () => {
          this.$Message.info('已取消删除！')
        }
      })
    },
    create () {
      this.$store.dispatch('testcase/create', this.test).then(() => {
        this.$Message.success(`成功创建！`)
        this.fetch()
        this.test.in = ''
        this.test.out = ''
      })
    },
    testcaseUrl ({ uuid }, type) {
      return testcaseUrl(this.$route.params.pid, uuid, type)
    }
  }
}
</script>

<style lang="stylus" scoped>
@import '../../styles/common'
</style>
